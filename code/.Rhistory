left_join(df_FS_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - rand,
method = "rand_interval_1") %>%
select(name, method, diff)
interval_2_S <- df_interval_stable %>%
select(c(name, site, interval_tmy_2)) %>%
left_join(df_FS_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - interval_tmy_2,
method = "rand_interval_2") %>%
select(name, method, diff)
interval_3_S <- df_interval_stable %>%
select(c(name, site, interval_tmy_3)) %>%
left_join(df_FS_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - interval_tmy_3,
method = "rand_interval_3") %>%
select(name, method, diff)
interval_7_S <- df_interval_stable %>%
select(c(name, site, interval_tmy_7)) %>%
left_join(df_FS_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - interval_tmy_7,
method = "rand_interval_7") %>%
select(name, method, diff)
df_TW_S <- rbind(interval_1_S, interval_2_S, interval_3_S, interval_7_S)
interval_1_V <- df_FS_tmy_variable %>%
left_join(df_FS_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - rand,
method = "rand_interval_1") %>%
select(name, method, diff)
interval_2_V <- df_interval_variable %>%
select(c(name, site, interval_tmy_2)) %>%
left_join(df_FS_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - interval_tmy_2,
method = "rand_interval_2") %>%
select(name, method, diff)
interval_3_V <- df_interval_variable %>%
select(c(name, site, interval_tmy_3)) %>%
left_join(df_FS_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - interval_tmy_3,
method = "rand_interval_3") %>%
select(name, method, diff)
interval_7_V <- df_interval_variable %>%
select(c(name, site, interval_tmy_7)) %>%
left_join(df_FS_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - interval_tmy_7,
method = "rand_interval_7") %>%
select(name, method, diff)
df_TW_V <- rbind(interval_1_V, interval_2_V, interval_3_V, interval_7_V)
# plot for combined dataset
interval_1_A <- bind_rows(interval_1_V, interval_1_S) %>%
select(name, interval_1_diff = diff)
interval_2_A <- bind_rows(interval_2_V, interval_2_S) %>%
select(name, interval_2_diff = diff)
interval_3_A <- bind_rows(interval_3_V, interval_3_S) %>%
select(name, interval_3_diff = diff)
interval_7_A <- bind_rows(interval_7_V, interval_7_S) %>%
select(name, interval_7_diff = diff)
df_TW_A <- interval_1_A %>%
left_join(interval_2_A, by = "name") %>%
left_join(interval_3_A, by = "name") %>%
left_join(interval_7_A, by = "name") %>%
pivot_longer(c(interval_1_diff, interval_2_diff, interval_3_diff, interval_7_diff), names_to = "method", values_to = "diff")
p_bottom <- df_TW_A %>%
mutate(method = as.factor(method),
method = recode_factor(method,
"interval_1_diff" = "Daily\nsampling",
"interval_2_diff" = "2-day\nsampling",
"interval_3_diff" = "3-day\nsampling",
"interval_7_diff" = "7-day\nsampling")) %>%
ggplot(aes(x = method, y = diff, fill = method)) +
geom_jitter(width = 0.2, alpha = 0.8, size = 0.5) +
geom_lv(k = 4, outlier.shape = NA) +
geom_boxplot(outlier.alpha = 0, coef = 0, fill = "#00000000", aes(color = method)) +
geom_hline(yintercept = 0, color = "#fb8072", linewidth = 1, lty = "dashed") +
geom_text(data = . %>% group_by(method) %>% summarise(mean = mean(diff)) %>% ungroup(),
aes(x = method, y = mean, label = paste0(round(mean, digits = 1), " %"))) +
scale_y_continuous(expand = c(0, 0),
breaks = breaks_pretty(n = 4),
labels = number_format(suffix = " %")) +
scale_fill_manual(values = ls_colors) +
scale_color_manual(values = c("grey80", "grey80", "grey80", "grey80")) +
labs(fill = NULL,
x = NULL,
y = "Error in fractional savings",
subtitle = str_glue("All {A_building} buildings with TMY weather")) +
coord_cartesian(ylim = c(-10, 10)) +
theme(panel.grid.major.y = element_line(color = "grey80", linewidth = 0.25),
legend.position = "none",
plot.margin = margin(t = 2, r = 7, b = 2, l = 2, unit = "mm"))
ggarrange(p_top, p_bottom,
ncol = 1, nrow = 2,
align = "hv",
legend = "none") +
plot_annotation(title = "M&V accuracy comparison")
ggsave(filename = "mean_interval.png", path = fig_path, units = "in", height = 9, width = 12, dpi = 300)
# sprt sequence plot for different sampling intervals
interval_1_S <- df_seq_FS_stable %>%
filter(seq == "eob") %>%
left_join(df_FS_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - FS,
method = "rand_interval_1") %>%
select(name, method, diff)
interval_2_S <- df_seq_interval_FS_stable %>%
filter(interval == 2 & seq == "eob") %>%
left_join(df_FS_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - FS,
method = "rand_interval_2") %>%
select(name, method, diff)
interval_3_S <- df_seq_interval_FS_stable %>%
filter(interval == 3 & seq == "eob") %>%
left_join(df_FS_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - FS,
method = "rand_interval_3") %>%
select(name, method, diff)
interval_7_S <- df_seq_interval_FS_stable %>%
filter(interval == 7 & seq == "eob") %>%
left_join(df_FS_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - FS,
method = "rand_interval_7") %>%
select(name, method, diff)
df_MW_S <- rbind(interval_1_S, interval_2_S, interval_3_S, interval_7_S)
# variable set
interval_1_V <- df_seq_FS_variable %>%
filter(seq == "eob") %>%
left_join(df_FS_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - FS,
method = "rand_interval_1") %>%
select(name, method, diff)
interval_2_V <- df_seq_interval_FS_variable %>%
filter(interval == 2 & seq == "eob") %>%
left_join(df_FS_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - FS,
method = "rand_interval_2") %>%
select(name, method, diff)
interval_3_V <- df_seq_interval_FS_variable %>%
filter(interval == 3 & seq == "eob") %>%
left_join(df_FS_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - FS,
method = "rand_interval_3") %>%
select(name, method, diff)
interval_7_V <- df_seq_interval_FS_variable %>%
filter(interval == 7 & seq == "eob") %>%
left_join(df_FS_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - FS,
method = "rand_interval_7") %>%
select(name, method, diff)
df_MW_V <- rbind(interval_1_V, interval_2_V, interval_3_V, interval_7_V)
# plot for combined dataset
interval_1_A <- bind_rows(interval_1_V, interval_1_S) %>%
select(name, interval_1_diff = diff)
interval_2_A <- bind_rows(interval_2_V, interval_2_S) %>%
select(name, interval_2_diff = diff)
interval_3_A <- bind_rows(interval_3_V, interval_3_S) %>%
select(name, interval_3_diff = diff)
interval_7_A <- bind_rows(interval_7_V, interval_7_S) %>%
select(name, interval_7_diff = diff)
df_MW_A <- interval_1_A %>%
left_join(interval_2_A, by = "name") %>%
left_join(interval_3_A, by = "name") %>%
left_join(interval_7_A, by = "name") %>%
pivot_longer(c(interval_1_diff, interval_2_diff, interval_3_diff, interval_7_diff), names_to = "method", values_to = "diff")
p_top <- df_MW_A %>%
mutate(method = as.factor(method),
method = recode_factor(method,
"interval_1_diff" = "Daily\nsampling",
"interval_2_diff" = "2-day\nsampling",
"interval_3_diff" = "3-day\nsampling",
"interval_7_diff" = "7-day\nsampling")) %>%
ggplot(aes(x = method, y = diff, fill = method)) +
geom_jitter(width = 0.2, alpha = 0.8, size = 0.5) +
geom_lv(k = 4, outlier.shape = NA) +
geom_boxplot(outlier.alpha = 0, coef = 0, fill = "#00000000", aes(color = method)) +
geom_hline(yintercept = 0, color = "#fb8072", linewidth = 1, lty = "dashed") +
geom_text(data = . %>% group_by(method) %>% summarise(mean = mean(diff)) %>% ungroup(),
aes(x = method, y = mean, label = paste0(round(mean, digits = 1), " %"))) +
scale_y_continuous(expand = c(0, 0),
breaks = breaks_pretty(n = 4),
labels = number_format(suffix = " %")) +
scale_fill_manual(values = ls_colors) +
scale_color_manual(values = c("grey80", "grey80", "grey80", "grey80")) +
labs(fill = NULL,
x = NULL,
y = "Error in fractional savings",
subtitle = str_glue("All {A_building} buildings with measured weather")) +
coord_cartesian(ylim = c(-10, 10)) +
theme(panel.grid.major.y = element_line(color = "grey80", linewidth = 0.25),
legend.position = "none",
axis.text.x = element_blank(),
plot.margin = margin(t = 2, r = 7, b = 2, l = 2, unit = "mm"))
# with tmy version
interval_1_S <- df_sprt_all_stable %>%
filter(seq == "eob") %>%
select(-c(seq, sprt, n_weeks)) %>%
left_join(df_FS_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - annual,
method = "rand_interval_1") %>%
select(name, method, diff)
interval_2_S <- df_seq_interval_nm_stable %>%
filter(interval == 2 & seq == "eob") %>%
left_join(df_FS_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - annual,
method = "rand_interval_2") %>%
select(name, method, diff)
interval_3_S <- df_seq_interval_nm_stable %>%
filter(interval == 3 & seq == "eob") %>%
left_join(df_FS_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - annual,
method = "rand_interval_3") %>%
select(name, method, diff)
interval_7_S <- df_seq_interval_nm_stable %>%
filter(interval == 7 & seq == "eob") %>%
left_join(df_FS_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - annual,
method = "rand_interval_7") %>%
select(name, method, diff)
df_TW_S <- rbind(interval_1_S, interval_2_S, interval_3_S, interval_7_S)
# variable set
interval_1_V <- df_sprt_all_variable %>%
filter(seq == "eob") %>%
select(-c(seq, sprt, n_weeks)) %>%
left_join(df_FS_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - annual,
method = "rand_interval_1") %>%
select(name, method, diff)
interval_2_V <- df_seq_interval_nm_variable %>%
filter(interval == 2 & seq == "eob") %>%
left_join(df_FS_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - annual,
method = "rand_interval_2") %>%
select(name, method, diff)
interval_3_V <- df_seq_interval_nm_variable %>%
filter(interval == 3 & seq == "eob") %>%
left_join(df_FS_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - annual,
method = "rand_interval_3") %>%
select(name, method, diff)
interval_7_V <- df_seq_interval_nm_variable %>%
filter(interval == 7 & seq == "eob") %>%
left_join(df_FS_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - annual,
method = "rand_interval_7") %>%
select(name, method, diff)
df_TW_V <- rbind(interval_1_V, interval_2_V, interval_3_V, interval_7_V)
# plot for combined dataset
interval_1_A <- bind_rows(interval_1_V, interval_1_S) %>%
select(name, interval_1_diff = diff)
interval_2_A <- bind_rows(interval_2_V, interval_2_S) %>%
select(name, interval_2_diff = diff)
interval_3_A <- bind_rows(interval_3_V, interval_3_S) %>%
select(name, interval_3_diff = diff)
interval_7_A <- bind_rows(interval_7_V, interval_7_S) %>%
select(name, interval_7_diff = diff)
df_TW_A <- interval_1_A %>%
left_join(interval_2_A, by = "name") %>%
left_join(interval_3_A, by = "name") %>%
left_join(interval_7_A, by = "name") %>%
pivot_longer(c(interval_1_diff, interval_2_diff, interval_3_diff, interval_7_diff), names_to = "method", values_to = "diff")
p_bottom <- df_TW_A %>%
mutate(method = as.factor(method),
method = recode_factor(method,
"interval_1_diff" = "Daily\nsampling",
"interval_2_diff" = "2-day\nsampling",
"interval_3_diff" = "3-day\nsampling",
"interval_7_diff" = "7-day\nsampling")) %>%
ggplot(aes(x = method, y = diff, fill = method)) +
geom_jitter(width = 0.2, alpha = 0.8, size = 0.5) +
geom_lv(k = 4, outlier.shape = NA) +
geom_boxplot(outlier.alpha = 0, coef = 0, fill = "#00000000", aes(color = method)) +
geom_hline(yintercept = 0, color = "#fb8072", linewidth = 1, lty = "dashed") +
geom_text(data = . %>% group_by(method) %>% summarise(mean = mean(diff)) %>% ungroup(),
aes(x = method, y = mean, label = paste0(round(mean, digits = 1), " %"))) +
scale_y_continuous(expand = c(0, 0),
breaks = breaks_pretty(n = 4),
labels = number_format(suffix = " %")) +
scale_fill_manual(values = ls_colors) +
scale_color_manual(values = c("grey80", "grey80", "grey80", "grey80")) +
labs(fill = NULL,
x = NULL,
y = "Error in fractional savings",
subtitle = str_glue("All {A_building} buildings with TMY weather")) +
coord_cartesian(ylim = c(-10, 10)) +
theme(panel.grid.major.y = element_line(color = "grey80", linewidth = 0.25),
legend.position = "none",
plot.margin = margin(t = 2, r = 7, b = 2, l = 2, unit = "mm"))
ggarrange(p_top, p_bottom,
ncol = 1, nrow = 2,
align = "hv",
legend = "none") +
plot_annotation(title = "M&V accuracy comparison")
ggsave(filename = "mean_interval_sprt.png", path = fig_path, units = "in", height = 9, width = 12, dpi = 300)
# null results
interval_1_S <- df_FS_null_stable %>%
filter(method != "conv") %>%
pivot_wider(names_from = method, values_from = savings) %>%
mutate(diff = true - rand,
method = "rand_interval_1") %>%
select(name, method, diff)
interval_2_S <- df_interval_null_stable %>%
select(c(name, site, interval_fs_2)) %>%
left_join(df_FS_null_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - interval_fs_2,
method = "rand_interval_2") %>%
select(name, method, diff)
interval_3_S <- df_interval_null_stable %>%
select(c(name, site, interval_fs_3)) %>%
left_join(df_FS_null_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - interval_fs_3,
method = "rand_interval_3") %>%
select(name, method, diff)
interval_7_S <- df_interval_null_stable %>%
select(c(name, site, interval_fs_7)) %>%
left_join(df_FS_null_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - interval_fs_7,
method = "rand_interval_7") %>%
select(name, method, diff)
df_MW_S <- rbind(interval_1_S, interval_2_S, interval_3_S, interval_7_S)
interval_1_V <- df_FS_null_variable %>%
filter(method != "conv") %>%
pivot_wider(names_from = method, values_from = savings) %>%
mutate(diff = true - rand,
method = "rand_interval_1") %>%
select(name, method, diff)
interval_2_V <- df_interval_null_variable %>%
select(c(name, site, interval_fs_2)) %>%
left_join(df_FS_null_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - interval_fs_2,
method = "rand_interval_2") %>%
select(name, method, diff)
interval_3_V <- df_interval_null_variable %>%
select(c(name, site, interval_fs_3)) %>%
left_join(df_FS_null_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - interval_fs_3,
method = "rand_interval_3") %>%
select(name, method, diff)
interval_7_V <- df_interval_null_variable %>%
select(c(name, site, interval_fs_7)) %>%
left_join(df_FS_null_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = savings - interval_fs_7,
method = "rand_interval_7") %>%
select(name, method, diff)
df_MW_V <- rbind(interval_1_V, interval_2_V, interval_3_V, interval_7_V)
# plot for combined dataset
interval_1_A <- bind_rows(interval_1_V, interval_1_S) %>%
select(name, interval_1_diff = diff)
interval_2_A <- bind_rows(interval_2_V, interval_2_S) %>%
select(name, interval_2_diff = diff)
interval_3_A <- bind_rows(interval_3_V, interval_3_S) %>%
select(name, interval_3_diff = diff)
interval_7_A <- bind_rows(interval_7_V, interval_7_S) %>%
select(name, interval_7_diff = diff)
df_MW_A <- interval_1_A %>%
left_join(interval_2_A, by = "name") %>%
left_join(interval_3_A, by = "name") %>%
left_join(interval_7_A, by = "name") %>%
pivot_longer(c(interval_1_diff, interval_2_diff, interval_3_diff, interval_7_diff), names_to = "method", values_to = "diff")
df_MW_A %>%
mutate(method = as.factor(method),
method = recode_factor(method,
"interval_1_diff" = "Daily\nsampling",
"interval_2_diff" = "2-day\nsampling",
"interval_3_diff" = "3-day\nsampling",
"interval_7_diff" = "7-day\nsampling")) %>%
ggplot(aes(x = method, y = diff, fill = method)) +
geom_jitter(width = 0.2, alpha = 0.8, size = 0.5) +
geom_lv(k = 4, outlier.shape = NA) +
geom_boxplot(outlier.alpha = 0, coef = 0, fill = "#00000000", aes(color = method)) +
geom_hline(yintercept = 0, color = "#fb8072", linewidth = 1, lty = "dashed") +
geom_text(data = . %>% group_by(method) %>% summarise(mean = mean(diff)) %>% ungroup(),
aes(x = method, y = mean, label = paste0(round(mean, digits = 1), " %"))) +
scale_y_continuous(expand = c(0, 0),
breaks = breaks_pretty(n = 4),
labels = number_format(suffix = " %")) +
scale_fill_manual(values = ls_colors) +
scale_color_manual(values = c("grey80", "grey80", "grey80", "grey80")) +
labs(fill = NULL,
x = NULL,
y = "Error in fractional savings",
title = "No-saving M&V accuracy comparison",
subtitle = str_glue("All {A_building} buildings with measure weather conditions")) +
coord_cartesian(ylim = c(-18, 18)) +
theme(panel.grid.major.y = element_line(color = "grey80", linewidth = 0.25),
legend.position = "none",
plot.margin = margin(t = 2, r = 7, b = 2, l = 2, unit = "mm"))
df_MW_A %>%
mutate(method = as.factor(method),
method = recode_factor(method,
"interval_1_diff" = "Daily\nsampling",
"interval_2_diff" = "2-day\nsampling",
"interval_3_diff" = "3-day\nsampling",
"interval_7_diff" = "7-day\nsampling")) %>%
ggplot(aes(x = method, y = diff, fill = method)) +
geom_jitter(width = 0.2, alpha = 0.8, size = 0.5) +
geom_lv(k = 4, outlier.shape = NA) +
geom_boxplot(outlier.alpha = 0, coef = 0, fill = "#00000000", aes(color = method)) +
geom_hline(yintercept = 0, color = "#fb8072", linewidth = 1, lty = "dashed") +
geom_text(data = . %>% group_by(method) %>% summarise(mean = mean(diff)) %>% ungroup(),
aes(x = method, y = mean, label = paste0(round(mean, digits = 1), " %"))) +
scale_y_continuous(expand = c(0, 0),
breaks = breaks_pretty(n = 4),
labels = number_format(suffix = " %")) +
scale_fill_manual(values = ls_colors) +
scale_color_manual(values = c("grey80", "grey80", "grey80", "grey80")) +
labs(fill = NULL,
x = NULL,
y = "Error in fractional savings",
title = "No-saving M&V accuracy comparison",
subtitle = str_glue("All {A_building} buildings with measure weather conditions")) +
coord_cartesian(ylim = c(-10, 10)) +
theme(panel.grid.major.y = element_line(color = "grey80", linewidth = 0.25),
legend.position = "none",
plot.margin = margin(t = 2, r = 7, b = 2, l = 2, unit = "mm"))
ggsave(filename = "mean_interval_null.png", path = fig_path, units = "in", height = 6, width = 12, dpi = 300)
#### ABS-CONT ####
rand_cont_S <- df_cont_stable %>%
select(name, site, cont_fs) %>%
left_join(df_FS_stable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = abs(savings - cont_fs),
method = "rand_fs") %>%
select(name, method, diff)
conv_S <- df_FS_stable %>%
filter(method != "rand") %>%
pivot_wider(names_from = method, values_from = savings) %>%
mutate(diff = abs(true - conv),
method = "conv") %>%
select(name, method, diff)
rand_final_S <- df_FS_stable %>%
filter(method != "conv") %>%
pivot_wider(names_from = method, values_from = savings) %>%
mutate(diff = abs(true - rand),
method = "rand_final") %>%
select(name, method, diff)
df_MW_S <- rbind(rand_cont_S, conv_S, rand_final_S)
# plot for the variable subset
rand_cont_V <- df_cont_variable %>%
select(name, site, cont_fs) %>%
left_join(df_FS_variable %>% filter(scenario == "ref" & method == "true"), by = c("name", "site")) %>%
mutate(diff = abs(savings - cont_fs),
method = "rand_fs") %>%
select(name, method, diff)
conv_V <- df_FS_variable %>%
filter(method != "rand") %>%
pivot_wider(names_from = method, values_from = savings) %>%
mutate(diff = abs(true - conv),
method = "conv") %>%
select(name, method, diff)
rand_final_V <- df_FS_variable %>%
filter(method != "conv") %>%
pivot_wider(names_from = method, values_from = savings) %>%
mutate(diff = abs(true - rand),
method = "rand_final") %>%
select(name, method, diff)
df_MW_V <- rbind(rand_cont_V, conv_V, rand_final_V)
# plot for combined dataset
rand_cont_A <- bind_rows(rand_cont_V, rand_cont_S) %>%
select(name, rand_cont_diff = diff)
conv_A <- bind_rows(conv_V, conv_S) %>%
select(name, conv_diff = diff)
rand_final_A <- bind_rows(rand_final_V, rand_final_S) %>%
select(name, rand_final_diff = diff)
df_MW_A <- rand_cont_A %>%
left_join(conv_A, by = "name") %>%
left_join(rand_final_A, by = "name") %>%
pivot_longer(c(rand_cont_diff, conv_diff, rand_final_diff), names_to = "method", values_to = "diff")
df_MW_A %>%
mutate(method = as.factor(method),
method = recode_factor(method, "conv_diff" = "Conventional", "rand_cont_diff" = "Randomized\n(20/80)", "rand_final_diff" = "Randomized\n(50/50)")) %>%
ggplot(aes(x = method, y = diff, fill = method)) +
geom_jitter(width = 0.2, alpha = 0.8, size = 0.5) +
geom_lv(k = 4, outlier.shape = NA) +
geom_boxplot(outlier.alpha = 0, coef = 0, fill = "#00000000", aes(color = method)) +
geom_hline(yintercept = 0, color = "#fb8072", linewidth = 1, lty = "dashed") +
geom_text(data = . %>% group_by(method) %>% summarise(mean = mean(diff)) %>% ungroup(),
aes(x = method, y = mean, label = paste0(round(mean, digits = 1), " %"))) +
scale_y_continuous(expand = c(0, 0),
breaks = breaks_pretty(n = 4),
labels = number_format(suffix = " %")) +
scale_fill_manual(values = ls_colors) +
scale_color_manual(values = c("grey80", "grey80", "grey80")) +
labs(fill = NULL,
x = NULL,
y = "Error in fractional savings",
title = "M&V accuracy comparison",
subtitle = str_glue("All {A_building} buildings with measured weather conditions")) +
coord_cartesian(ylim = c(-18, 18)) +
theme(panel.grid.major.y = element_line(color = "grey80", linewidth = 0.25),
legend.position = "none",
plot.margin = margin(t = 2, r = 7, b = 2, l = 2, unit = "mm"))
df_MW_A %>%
mutate(method = as.factor(method),
method = recode_factor(method, "conv_diff" = "Conventional", "rand_cont_diff" = "Randomized\n(20/80)", "rand_final_diff" = "Randomized\n(50/50)")) %>%
ggplot(aes(x = method, y = diff, fill = method)) +
geom_jitter(width = 0.2, alpha = 0.8, size = 0.5) +
geom_lv(k = 4, outlier.shape = NA) +
geom_boxplot(outlier.alpha = 0, coef = 0, fill = "#00000000", aes(color = method)) +
geom_hline(yintercept = 0, color = "#fb8072", linewidth = 1, lty = "dashed") +
geom_text(data = . %>% group_by(method) %>% summarise(mean = mean(diff)) %>% ungroup(),
aes(x = method, y = mean, label = paste0(round(mean, digits = 1), " %"))) +
scale_y_continuous(expand = c(0, 0),
breaks = breaks_pretty(n = 4),
labels = number_format(suffix = " %")) +
scale_fill_manual(values = ls_colors) +
scale_color_manual(values = c("grey80", "grey80", "grey80")) +
labs(fill = NULL,
x = NULL,
y = "Error in fractional savings",
title = "M&V accuracy comparison",
subtitle = str_glue("All {A_building} buildings with measured weather conditions")) +
coord_cartesian(ylim = c(0, 23)) +
theme(panel.grid.major.y = element_line(color = "grey80", linewidth = 0.25),
legend.position = "none",
plot.margin = margin(t = 2, r = 7, b = 2, l = 2, unit = "mm"))
ggsave(filename = "abs_cont.png", path = fig_path, units = "in", height = 6, width = 12, dpi = 300)
source("~/Documents/Mac/ClassMaterial/ARCH299/Genome/cbe_genome_mnv/code/graphical.R", echo=TRUE)
